---
title: 魔术函数
permalink: /tutorials/python/magic_function/
---


python中的下划线是一个特殊的字符，主要有两种用法：

- __function__,前后两个下划线，表示python中的魔术方法；
- _function_,下划线前缀和后缀，表示内部使用或者非公开接口；


# 1、魔术函数

在Python中，双下划线（"__"）用于标识特殊的魔术方法（Magic Methods）或双下划线方法（Dunder Methods）。这些方法具有特殊的名称和用途，它们不是通常意义上的普通方法，而是在对象生命周期中由Python调用的特殊方法。以下是一些常见的双下划线方法及其用途：

1. **__init__**：这是一个构造函数，在创建对象时自动调用，用于对象的初始化。例如：
```plain
pythonCopy code
class MyClass:
    def __init__(self, arg1, arg2):
        self.arg1 = arg1
        self.arg2 = arg2
```

1. **__str__**：这个方法用于返回对象的人类可读的字符串表示，通常用于**print**函数或**str()**函数的输出。例如：
```plain
pythonCopy code
class MyClass:
    def __str__(self):
        return f"MyClass instance with attributes: {self.arg1}, {self.arg2}"
```

1. **__repr__**：这个方法用于返回对象的"官方"字符串表示，通常用于开发和调试中。例如：
```plain
pythonCopy code
class MyClass:
    def __repr__(self):
        return f"MyClass({self.arg1}, {self.arg2})"
```

1. **__len__**：这个方法用于返回对象的长度，通常用于内置的**len()**函数。例如：
```plain
pythonCopy code
class MyList:
    def __init__(self, data):
        self.data = data
    
    def __len__(self):
        return len(self.data)
```

1. **__getitem__**和**__setitem__**：这些方法用于实现对象的索引访问和赋值操作，通常用于支持类似于列表的索引操作。
2. **__eq__**：这个方法用于定义对象之间的相等性比较，通常用于**==**操作符的行为。
3. **__lt__**, **__le__**, **__gt__**, **__ge__**：这些方法用于定义对象之间的比较操作，分别对应于 **<**, **<=**, **>**, **>=** 操作符的行为。
4. **__add__** 和 **__sub__**：这些方法用于定义对象之间的加法和减法操作，通常用于**+**和**-**操作符的行为。
5. **__call__**：这个方法允许将对象像函数一样调用，它可以将一个类的实例变成可调用的对象。这只是一些常见的双下划线方法，Python中还有更多的魔术方法，每个魔术方法都有其特定的用途。你可以根据你的需要自定义这些方法来定制类的行为。这些魔术方法是Python面向对象编程中非常有用的特性。

__all__是一个模块级别的变量，它被用来定义模块中哪些名称是导出的（即哪些名称是公有的，可以被from module import *这样的导入语句导入）。如果没有定义__all__，那么所有的名称都会被导出。
## 2、魔术函数的调用

是的，魔术方法会在特定的情况下自动被Python解释器调用，而不需要你显式地调用它们。这些方法是Python中的特殊方法，它们具有预定的名称和行为，用于在对象的生命周期中执行特定的操作。
以下是一些常见的魔术方法及其自动调用的时机：

1. **__init__**：在创建对象时自动调用，用于对象的初始化。
2. **__str__**：当使用**print()**函数或**str()**函数时自动调用，用于返回对象的人类可读的字符串表示。
3. **__repr__**：当使用**repr()**函数或在交互式环境中输出对象时自动调用，用于返回对象的"官方"字符串表示。
4. **__len__**：当使用内置的**len()**函数时自动调用，用于返回对象的长度。
5. **__getitem__** 和 **__setitem__**：在进行索引访问或赋值操作时自动调用。
6. **__eq__**：在进行相等性比较操作时自动调用，例如使用**==**操作符。
7. **__lt__**, **__le__**, **__gt__**, **__ge__**：在进行比较操作时自动调用，例如使用**<**, **<=**, **>**, **>=** 操作符。
8. **__add__** 和 **__sub__**：在进行加法和减法操作时自动调用，例如使用**+**和**-**操作符。
9. **__call__**：当将对象像函数一样调用时自动调用，允许将对象变成可调用的。这些魔术方法在适当的情况下由Python解释器自动调用，以执行对象的特定操作。通过实现这些方法，你可以自定义类的行为，使其在不同的上下文中表现出特定的行为。这是Python面向对象编程中的强大功能之一。

